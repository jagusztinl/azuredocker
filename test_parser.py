import json
import math
from unittest import TestCase

from procs import parser
from procs.gpx_parser import calculate_bearing


csv_blob = """1418771774000,52.516482,13.464733,11.000000,278.000000,4.000000
1443801775000,52.516497,13.464649,11.000000,281.600006,4.250000
1443801776000,52.516518,13.464572,11.000000,287.100006,4.250000
1443801777000,52.516539,13.464491,12.000000,289.000000,4.250000
1443801778000,52.516563,13.464410,12.000000,290.000000,4.250000
1443801779000,52.516583,13.464325,12.000000,287.700012,4.500000
1443801780000,52.516598,13.464245,13.000000,285.899994,4.500000
1443801781000,52.516609,13.464170,12.000000,284.299988,4.250000
1443801782000,52.516619,13.464102,12.000000,281.700012,4.250000
1443801783000,52.516632,13.464035,12.000000,281.000000,4.250000
1443801784000,52.516645,13.463972,12.000000,281.100006,4.250000
1443801785000,52.516656,13.463911,12.000000,282.600006,4.250000
1443801786000,52.516672,13.463854,12.000000,285.200012,4.250000
1443801787000,52.516692,13.463796,11.000000,288.700012,4.000000
1443801788000,52.516716,13.463740,12.000000,293.700012,4.000000
1443801789000,52.516741,13.463683,12.000000,296.600006,4.000000
1443801790000,52.516762,13.463626,12.000000,295.100006,4.000000
1443801791000,52.516778,13.463569,12.000000,291.700012,4.000000
1443801792000,52.516788,13.463514,12.000000,288.299988,4.000000
1443801793000,52.516799,13.463456,12.000000,287.700012,4.000000
1443801794000,52.516812,13.463396,12.000000,288.899994,4.000000
1443801795000,52.516822,13.463337,12.000000,289.200012,4.000000
1443801796000,52.516836,13.463284,12.000000,292.700012,4.000000
1443801797000,52.516852,13.463224,12.000000,295.200012,4.000000
1443801798000,52.516869,13.463161,12.000000,296.899994,4.000000
1443801799000,52.516883,13.463095,12.000000,293.100006,4.000000
1443801800000,52.516896,13.463025,12.000000,290.500000,4.000000
1443801801000,52.516906,13.462948,12.000000,286.100006,4.500000
1443801802000,52.516916,13.462870,12.000000,284.799988,4.500000
1443801803000,52.516928,13.462792,12.000000,283.899994,4.500000
1443801804000,52.516940,13.462715,12.000000,285.000000,4.500000
1443801805000,52.516951,13.462637,13.000000,285.100006,4.500000
1443801806000,52.516955,13.462564,13.000000,279.500000,4.250000
1443801807000,52.516954,13.462493,13.000000,275.100006,4.250000
1443801808000,52.516951,13.462447,13.000000,270.100006,3.000000
1443801809000,52.516949,13.462400,12.000000,273.100006,2.750000
1443801810000,52.516942,13.462351,12.000000,271.399994,2.750000
1443801811000,52.516946,13.462303,12.000000,278.299988,3.000000
1443801812000,52.516950,13.462255,13.000000,280.600006,3.000000
1443801813000,52.516955,13.462204,13.000000,287.200012,3.000000
1443801814000,52.516963,13.462151,13.000000,286.899994,3.000000
1443801815000,52.516975,13.462075,13.000000,286.799988,4.000000
1443801816000,52.516983,13.462002,13.000000,285.000000,4.000000
1443801817000,52.516989,13.461928,13.000000,281.600006,4.000000
1443801818000,52.516994,13.461858,13.000000,280.000000,3.750000
1443801819000,52.517002,13.461787,13.000000,280.899994,3.750000
1443801820000,52.517011,13.461715,13.000000,283.000000,4.000000
1443801821000,52.517017,13.461643,13.000000,283.000000,4.000000
1443801822000,52.517019,13.461570,13.000000,280.799988,3.750000
1443801823000,52.517017,13.461499,13.000000,276.500000,3.750000
1443801824000,52.517013,13.461440,13.000000,274.100006,3.500000
1443801825000,52.517011,13.461415,13.000000,268.700012,1.500000
1443801826000,52.517001,13.461385,12.000000,246.899994,1.750000
1443801827000,52.516992,13.461354,12.000000,235.199997,2.000000
1443801828000,52.516980,13.461329,12.000000,226.100006,2.000000
1443801829000,52.516964,13.461299,12.000000,224.100006,2.750000
1443801830000,52.516928,13.461270,11.000000,209.000000,4.000000
1443801831000,52.516883,13.461252,11.000000,197.899994,5.000000
1443801832000,52.516843,13.461268,11.000000,190.399994,5.000000
1443801833000,52.516803,13.461257,11.000000,193.600006,5.000000
1443801834000,52.516757,13.461249,11.000000,192.199997,5.000000
1443801835000,52.516707,13.461242,12.000000,190.899994,5.250000
1443801836000,52.516666,13.461206,12.000000,196.899994,5.000000
1443801837000,52.516622,13.461178,11.000000,203.699997,4.750000
1443801838000,52.516570,13.461174,11.000000,195.000000,4.750000
1443801839000,52.516518,13.461171,10.000000,194.600006,5.000000
1443801840000,52.516473,13.461158,10.000000,197.699997,5.250000
1443801841000,52.516410,13.461160,10.000000,194.699997,5.250000
1443801842000,52.516361,13.461149,11.000000,193.100006,5.500000
1443801843000,52.516315,13.461115,11.000000,194.899994,5.750000
1443801844000,52.516280,13.461083,10.000000,194.600006,5.750000
1443801845000,52.516230,13.461057,11.000000,195.100006,5.500000
1443801846000,52.516187,13.461037,11.000000,196.300003,5.250000
1443801847000,52.516137,13.461006,10.000000,197.000000,5.250000
1443801848000,52.516097,13.460995,10.000000,188.100006,4.750000
1443801849000,52.516051,13.460962,10.000000,191.000000,5.000000
1443801850000,52.516002,13.460938,10.000000,195.199997,5.250000
1443801851000,52.515952,13.460929,11.000000,193.399994,5.250000
1443801852000,52.515913,13.460904,11.000000,195.600006,5.000000
1443801853000,52.515868,13.460893,11.000000,193.600006,5.000000
1443801854000,52.515828,13.460868,11.000000,194.800003,4.750000
1443801855000,52.515786,13.460852,11.000000,192.600006,4.500000
1443801856000,52.515750,13.460866,10.000000,197.100006,4.250000
1443801857000,52.515719,13.460837,10.000000,198.899994,4.250000
1443801858000,52.515674,13.460821,11.000000,197.300003,4.250000
1443801859000,52.515642,13.460807,11.000000,194.399994,4.000000
1443801860000,52.515615,13.460790,10.000000,194.199997,4.000000
1443801861000,52.515581,13.460747,10.000000,203.600006,3.750000
1443801862000,52.515552,13.460697,10.000000,202.600006,3.750000
1443801863000,52.515513,13.460682,10.000000,199.300003,3.750000
1443801864000,52.515482,13.460662,10.000000,199.000000,3.750000
1443801865000,52.515451,13.460638,10.000000,201.199997,4.000000
1443801866000,52.515419,13.460618,10.000000,199.800003,3.750000
1443801867000,52.515386,13.460596,11.000000,200.199997,3.750000
1443801868000,52.515356,13.460576,10.000000,199.300003,3.500000
1443801869000,52.515338,13.460562,10.000000,199.300003,2.250000
1443801870000,52.515331,13.460545,10.000000,199.000000,1.500000
1443801871000,52.515326,13.460529,10.000000,199.399994,1.000000
1443801872000,52.515326,13.460517,10.000000,199.399994,0.500000
1443801873000,52.515325,13.460503,11.000000,199.399994,0.500000
1443801874000,52.515324,13.460493,11.000000,199.399994,0.250000
1443801875000,52.515319,13.460493,11.000000,199.399994,0.500000
1443801876000,52.515317,13.460494,12.000000,199.399994,0.500000
1443801877000,52.515313,13.460494,12.000000,199.399994,0.250000
1443801878000,52.515310,13.460496,12.000000,199.399994,0.250000
1443801879000,52.515307,13.460499,12.000000,199.399994,0.250000
1443801880000,52.515316,13.460505,12.000000,0.000000,0.000000
1443801881000,52.515324,13.460509,12.000000,0.000000,0.000000
1443801882000,52.515330,13.460514,12.000000,0.000000,0.000000
1443801883000,52.515336,13.460517,12.000000,0.000000,0.000000
1443801884000,52.515337,13.460522,12.000000,0.000000,0.000000
1443801885000,52.515339,13.460523,12.000000,0.000000,0.000000
1443801886000,52.515342,13.460525,13.000000,0.000000,0.000000
1443801887000,52.515341,13.460528,12.000000,0.000000,0.000000
1443801888000,52.515342,13.460529,13.000000,0.000000,0.000000
1443801889000,52.515340,13.460528,13.000000,0.000000,0.000000
1443801890000,52.515339,13.460529,13.000000,0.000000,0.000000
1443801891000,52.515338,13.460531,13.000000,0.000000,0.000000
1443801892000,52.515337,13.460530,13.000000,0.000000,0.000000
1443801893000,52.515337,13.460529,12.000000,0.000000,0.000000
1443801894000,52.515337,13.460528,12.000000,0.000000,0.000000
1443801895000,52.515337,13.460528,12.000000,0.000000,0.000000
1443801896000,52.515337,13.460528,12.000000,0.000000,0.000000
1443801897000,52.515337,13.460528,12.000000,0.000000,0.000000
1443801898000,52.515337,13.460527,11.000000,0.000000,0.000000
1443801899000,52.515337,13.460527,11.000000,0.000000,0.000000
1443801900000,52.515337,13.460526,11.000000,0.000000,0.000000
1443801901000,52.515337,13.460527,11.000000,0.000000,0.000000
1443801902000,52.515336,13.460527,11.000000,0.000000,0.000000
1443801903000,52.515337,13.460526,11.000000,0.000000,0.000000
1443801904000,52.515338,13.460525,11.000000,0.000000,0.000000
1443801905000,52.515338,13.460525,11.000000,0.000000,0.000000
1443801906000,52.515338,13.460523,11.000000,0.000000,0.000000
1443801907000,52.515338,13.460522,11.000000,0.000000,0.000000
1443801908000,52.515338,13.460520,11.000000,0.000000,0.000000
1443801909000,52.515338,13.460518,11.000000,0.000000,0.000000
1443801910000,52.515338,13.460517,11.000000,0.000000,0.000000
1443801911000,52.515338,13.460516,11.000000,0.000000,0.000000
1443801912000,52.515339,13.460516,11.000000,0.000000,0.000000
1443801913000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801914000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801915000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801916000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801917000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801918000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801919000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801920000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801921000,52.515339,13.460517,11.000000,0.000000,0.000000
1443801922000,52.515339,13.460516,10.000000,0.000000,0.000000
1443801923000,52.515340,13.460516,11.000000,0.000000,0.000000
1443801924000,52.515327,13.460514,10.000000,185.100006,1.500000
1443801925000,52.515310,13.460488,11.000000,193.100006,2.250000
1443801926000,52.515283,13.460467,11.000000,192.399994,3.000000
1443801927000,52.515239,13.460443,11.000000,190.500000,4.500000
1443801928000,52.515188,13.460415,11.000000,188.699997,5.250000
1443801929000,52.515134,13.460331,12.000000,193.100006,5.250000
1443801930000,52.515110,13.460348,13.000000,188.899994,4.750000
1443801931000,52.515031,13.460174,12.000000,210.300003,6.750000
1443801932000,52.514997,13.460161,12.000000,209.300003,5.500000
1443801933000,52.514962,13.460126,12.000000,210.199997,5.500000
1443801934000,52.514909,13.460093,12.000000,207.500000,6.000000
1443801935000,52.514857,13.460059,13.000000,203.600006,5.750000
1443801936000,52.514812,13.460039,13.000000,201.300003,5.500000
1443801937000,52.514783,13.460010,14.000000,203.600006,5.000000
1443801938000,52.514727,13.460000,15.000000,197.399994,5.500000
1443801939000,52.514688,13.459898,15.000000,211.300003,5.500000
1443801940000,52.514645,13.459922,14.000000,200.899994,5.000000
1443801941000,52.514602,13.459878,13.000000,196.600006,4.500000
1443801942000,52.514570,13.459835,13.000000,208.300003,4.750000
1443801943000,52.514548,13.459798,13.000000,212.100006,4.250000
1443801944000,52.514517,13.459762,13.000000,212.699997,4.250000
1443801945000,52.514468,13.459726,12.000000,212.600006,5.000000
1443801946000,52.514438,13.459694,12.000000,204.399994,4.750000
1443801947000,52.514373,13.459679,12.000000,203.000000,5.000000
1443801948000,52.514300,13.459661,13.000000,201.899994,5.250000
1443801949000,52.514264,13.459603,13.000000,210.800003,5.000000
1443801950000,52.514216,13.459561,14.000000,208.000000,5.000000
1443801951000,52.514187,13.459524,13.000000,211.899994,4.250000
1443801952000,52.514135,13.459479,13.000000,205.500000,5.250000
1443801953000,52.514092,13.459433,13.000000,207.699997,4.250000
1443801954000,52.514078,13.459415,13.000000,210.000000,4.000000
1443801955000,52.514046,13.459365,13.000000,217.600006,4.750000
1443801956000,52.514037,13.459302,12.000000,215.399994,4.500000
1443801957000,52.513992,13.459277,12.000000,204.100006,4.500000
1443801958000,52.513952,13.459257,12.000000,197.600006,4.250000
1443801959000,52.513926,13.459240,12.000000,202.300003,3.500000
1443801960000,52.513880,13.459200,12.000000,205.500000,4.500000
1443801961000,52.513846,13.459143,12.000000,213.699997,4.500000
1443801962000,52.513795,13.459114,12.000000,205.000000,5.000000
1443801963000,52.513749,13.459068,13.000000,205.199997,5.000000
1443801964000,52.513699,13.459012,14.000000,205.000000,5.250000
1443801965000,52.513647,13.458967,13.000000,200.800003,5.000000
1443801966000,52.513606,13.458937,14.000000,197.899994,4.500000
1443801967000,52.513572,13.458895,13.000000,202.000000,4.750000
1443801968000,52.513525,13.458865,14.000000,202.600006,4.750000
1443801969000,52.513484,13.458809,14.000000,205.600006,5.000000
1443801970000,52.513438,13.458766,14.000000,206.899994,5.500000
1443801971000,52.513397,13.458745,14.000000,204.000000,4.250000
1443801972000,52.513367,13.458702,14.000000,197.199997,4.250000
1443801973000,52.513328,13.458641,14.000000,200.399994,4.750000
1443801974000,52.513290,13.458624,13.000000,197.899994,5.000000
1443801975000,52.513245,13.458605,14.000000,198.000000,4.750000
1443801976000,52.513209,13.458527,14.000000,202.899994,5.000000
1443801977000,52.513161,13.458472,14.000000,204.100006,4.750000
1443801978000,52.513113,13.458444,14.000000,204.199997,4.250000
1443801979000,52.513040,13.458430,14.000000,198.600006,4.250000
1443801980000,52.512971,13.458407,14.000000,197.300003,4.250000
1443801981000,52.512897,13.458373,14.000000,198.800003,4.250000
1443801982000,52.512865,13.458245,13.000000,209.600006,4.250000
1443801983000,52.512863,13.458203,13.000000,213.500000,3.500000
1443801984000,52.512824,13.458160,13.000000,212.800003,3.500000
1443801985000,52.512814,13.458076,13.000000,224.800003,3.250000
1443801986000,52.512796,13.458056,13.000000,221.199997,2.750000
1443801987000,52.512788,13.458019,12.000000,230.100006,2.500000
1443801988000,52.512766,13.458015,11.000000,202.199997,2.250000
1443801989000,52.512751,13.458001,11.000000,214.699997,2.000000
1443801990000,52.512735,13.457990,11.000000,201.300003,2.250000
1443801991000,52.512717,13.457975,11.000000,204.100006,2.250000
1443801992000,52.512698,13.457957,11.000000,204.800003,2.500000
1443801993000,52.512672,13.457930,11.000000,206.500000,3.500000
1443801994000,52.512646,13.457909,11.000000,204.300003,3.750000
1443801995000,52.512617,13.457884,11.000000,203.800003,4.000000
1443801996000,52.512585,13.457855,11.000000,204.600006,4.000000
1443801997000,52.512550,13.457821,11.000000,206.100006,4.500000
1443801998000,52.512510,13.457789,11.000000,205.000000,4.500000
1443801999000,52.512466,13.457760,11.000000,202.899994,4.500000
1443802000000,52.512424,13.457731,12.000000,201.399994,4.500000
1443802001000,52.512382,13.457697,12.000000,202.199997,4.500000
1443802002000,52.512338,13.457670,12.000000,201.199997,4.500000
1443802003000,52.512291,13.457648,13.000000,198.800003,4.500000
1443802004000,52.512247,13.457639,12.000000,192.500000,4.500000
1443802005000,52.512204,13.457628,11.000000,190.100006,4.500000
1443802006000,52.512162,13.457615,11.000000,189.199997,4.500000
1443802007000,52.512117,13.457600,11.000000,190.300003,4.500000
1443802008000,52.512079,13.457571,10.000000,190.800003,4.500000
1443802009000,52.512040,13.457549,10.000000,190.699997,4.500000
1443802010000,52.512004,13.457532,10.000000,189.000000,4.500000
1443802011000,52.511968,13.457520,10.000000,186.500000,4.500000
1443802012000,52.511937,13.457509,10.000000,187.600006,3.750000
1443802013000,52.511909,13.457492,10.000000,191.500000,3.500000
1443802014000,52.511878,13.457475,10.000000,194.500000,3.500000
1443802015000,52.511848,13.457463,10.000000,189.699997,3.250000
1443802016000,52.511820,13.457453,10.000000,187.600006,3.000000
1443802017000,52.511793,13.457437,10.000000,186.699997,3.000000
1443802018000,52.511763,13.457419,10.000000,192.000000,3.000000
1443802019000,52.511735,13.457406,10.000000,190.199997,3.000000
1443802020000,52.511710,13.457401,10.000000,184.100006,3.000000
1443802021000,52.511686,13.457409,10.000000,169.100006,3.000000
1443802022000,52.511666,13.457419,11.000000,158.600006,3.000000
1443802023000,52.511656,13.457429,11.000000,144.300003,2.750000
1443802024000,52.511651,13.457452,12.000000,130.300003,2.750000
1443802025000,52.511652,13.457490,11.000000,110.599998,3.000000
1443802026000,52.511652,13.457536,11.000000,105.599998,3.000000
1443802027000,52.511650,13.457610,11.000000,102.199997,4.750000
1443802028000,52.511650,13.457688,12.000000,101.400002,4.750000
1443802029000,52.511660,13.457797,13.000000,103.900002,5.250000
1443802030000,52.511658,13.457895,13.000000,100.800003,5.500000
1443802031000,52.511662,13.457977,14.000000,96.199997,5.250000
1443802032000,52.511662,13.458033,16.000000,95.599998,4.750000
1443802033000,52.511642,13.458072,16.000000,101.900002,4.250000
1443802034000,52.511670,13.458191,18.000000,91.199997,5.000000
1443802035000,52.511637,13.458210,18.000000,100.300003,4.250000
1443802036000,52.511644,13.458312,15.000000,97.199997,5.500000
1443802037000,52.511627,13.458427,15.000000,96.000000,5.500000
1443802038000,52.511604,13.458486,16.000000,102.099998,5.000000
1443802039000,52.511601,13.458529,16.000000,105.300003,4.750000
1443802040000,52.511565,13.458586,15.000000,110.599998,4.750000
1443802041000,52.511506,13.458648,13.000000,107.800003,5.750000
1443802042000,52.511464,13.458731,13.000000,109.800003,5.750000
1443802043000,52.511418,13.458838,13.000000,110.800003,6.250000
1443802044000,52.511435,13.458934,12.000000,92.699997,6.500000
1443802045000,52.511426,13.458997,12.000000,107.800003,5.250000
1443802046000,52.511391,13.459089,12.000000,108.400002,5.500000
1443802047000,52.511400,13.459156,12.000000,101.099998,5.250000
1443802048000,52.511396,13.459237,12.000000,97.500000,5.500000
1443802049000,52.511404,13.459313,13.000000,99.500000,5.500000
1443802050000,52.511384,13.459390,12.000000,105.699997,5.250000
1443802051000,52.511380,13.459498,12.000000,106.000000,5.750000
1443802052000,52.511369,13.459563,12.000000,106.400002,5.000000
1443802053000,52.511362,13.459652,12.000000,105.699997,5.000000
1443802054000,52.511355,13.459741,12.000000,101.500000,5.250000
1443802055000,52.511345,13.459887,12.000000,104.099998,5.000000
1443802056000,52.511346,13.460026,12.000000,101.699997,5.500000
1443802057000,52.511338,13.460102,13.000000,103.000000,5.500000
1443802058000,52.511316,13.460179,12.000000,104.699997,5.500000
1443802059000,52.511298,13.460241,13.000000,105.800003,5.250000
1443802060000,52.511302,13.460303,14.000000,100.400002,4.750000
1443802061000,52.511294,13.460424,15.000000,100.699997,5.750000
1443802062000,52.511297,13.460523,15.000000,96.500000,6.000000
1443802063000,52.511277,13.460558,13.000000,102.400002,5.000000
1443802064000,52.511257,13.460660,12.000000,101.500000,5.000000
1443802065000,52.511244,13.460792,12.000000,103.000000,5.000000
1443802066000,52.511214,13.460854,12.000000,105.900002,4.750000
1443802067000,52.511204,13.460911,12.000000,107.599998,4.500000
1443802068000,52.511190,13.460985,12.000000,110.699997,4.000000
1443802069000,52.511167,13.461005,12.000000,109.699997,3.500000
1443802070000,52.511185,13.461040,11.000000,73.099998,3.250000
1443802071000,52.511187,13.461064,11.000000,72.900002,3.250000
1443802072000,52.511180,13.461083,11.000000,68.900002,3.000000
1443802073000,52.511209,13.461124,12.000000,58.099998,3.250000
1443802074000,52.511220,13.461138,13.000000,50.500000,3.000000
1443802075000,52.511242,13.461169,13.000000,43.799999,3.000000
1443802076000,52.511298,13.461181,12.000000,19.000000,3.750000
1443802077000,52.511340,13.461187,12.000000,15.900000,4.000000
1443802078000,52.511375,13.461199,12.000000,15.700000,4.000000
1443802079000,52.511411,13.461198,12.000000,9.800000,4.000000
1443802080000,52.511451,13.461198,12.000000,7.200000,4.250000
1443802081000,52.511499,13.461207,12.000000,7.800000,4.250000
1443802082000,52.511592,13.461219,12.000000,11.900000,5.000000
1443802083000,52.511637,13.461236,12.000000,5.900000,4.500000
1443802084000,52.511680,13.461260,12.000000,7.100000,4.000000
1443802085000,52.511712,13.461265,12.000000,7.100000,4.000000
1443802086000,52.511747,13.461286,13.000000,10.200000,3.750000
1443802087000,52.511777,13.461327,13.000000,14.700000,3.750000
1443802088000,52.511800,13.461346,12.000000,9.500000,4.000000
1443802089000,52.511818,13.461356,12.000000,8.800000,3.750000
1443802090000,52.511870,13.461391,12.000000,9.100000,4.250000
1443802091000,52.511928,13.461393,11.000000,7.000000,4.000000
1443802092000,52.511965,13.461401,12.000000,8.900000,4.000000
1443802093000,52.512001,13.461416,12.000000,11.000000,4.000000
1443802094000,52.512032,13.461436,12.000000,12.500000,4.000000
1443802095000,52.512060,13.461452,11.000000,15.800000,3.750000
1443802096000,52.512073,13.461453,11.000000,11.400000,2.250000
1443802097000,52.512087,13.461436,11.000000,354.500000,2.250000
1443802098000,52.512110,13.461423,11.000000,343.600006,2.500000
1443802099000,52.512140,13.461417,12.000000,349.600006,2.750000
1443802100000,52.512171,13.461425,12.000000,2.000000,3.000000
1443802101000,52.512208,13.461440,12.000000,9.300000,3.500000
1443802102000,52.512242,13.461467,13.000000,17.900000,3.750000
1443802103000,52.512284,13.461504,12.000000,23.600000,4.000000
1443802104000,52.512331,13.461544,12.000000,25.500000,4.000000
1443802105000,52.512387,13.461582,11.000000,22.400000,5.000000
1443802106000,52.512474,13.461664,11.000000,18.000000,5.000000
1443802107000,52.512520,13.461700,11.000000,19.900000,5.000000
1443802108000,52.512569,13.461738,12.000000,17.400000,5.250000
1443802109000,52.512618,13.461762,13.000000,17.400000,5.000000
1443802110000,52.512660,13.461803,13.000000,19.299999,5.250000
1443802111000,52.512710,13.461813,14.000000,16.799999,5.250000
1443802112000,52.512740,13.461880,13.000000,19.900000,4.750000
1443802113000,52.512786,13.461916,13.000000,22.200001,4.500000
1443802114000,52.512831,13.461931,12.000000,21.799999,4.500000
1443802115000,52.512873,13.461935,12.000000,14.700000,4.500000
1443802116000,52.512912,13.461929,12.000000,14.000000,4.750000
1443802117000,52.512955,13.461960,12.000000,14.700000,4.750000
1443802118000,52.512981,13.462072,12.000000,23.299999,5.000000
1443802119000,52.513047,13.462072,12.000000,16.000000,5.750000
1443802120000,52.513097,13.462077,13.000000,14.800000,5.750000
1443802121000,52.513152,13.462192,13.000000,23.700001,6.500000
1443802122000,52.513214,13.462226,14.000000,22.299999,6.750000
1443802123000,52.513291,13.462256,14.000000,18.700001,6.750000
1443802124000,52.513311,13.462206,14.000000,1.100000,4.750000
1443802125000,52.513333,13.462215,13.000000,356.500000,3.750000
1443802126000,52.513363,13.462231,13.000000,11.700000,4.500000
1443802127000,52.513415,13.462257,13.000000,10.200000,4.250000
1443802128000,52.513476,13.462331,13.000000,24.700001,4.500000
1443802129000,52.513497,13.462373,13.000000,34.000000,4.000000
1443802130000,52.513517,13.462369,13.000000,18.600000,3.750000
1443802131000,52.513543,13.462343,14.000000,4.700000,2.750000
1443802132000,52.513577,13.462360,15.000000,4.300000,3.000000
1443802133000,52.513618,13.462400,15.000000,21.100000,3.750000
1443802134000,52.513641,13.462413,15.000000,20.799999,3.500000
1443802135000,52.513670,13.462440,15.000000,19.900000,3.500000
1443802136000,52.513701,13.462463,15.000000,19.100000,3.750000
1443802137000,52.513729,13.462475,14.000000,16.200001,3.500000
1443802138000,52.513759,13.462488,14.000000,16.100000,3.500000
1443802139000,52.513788,13.462500,14.000000,14.200000,3.500000
1443802140000,52.513817,13.462510,14.000000,12.800000,3.500000
1443802141000,52.513849,13.462533,14.000000,7.600000,3.500000
1443802142000,52.513878,13.462555,13.000000,8.500000,3.250000
1443802143000,52.513897,13.462564,13.000000,3.300000,2.250000
1443802144000,52.513917,13.462570,12.000000,359.500000,2.250000
1443802145000,52.513941,13.462583,12.000000,359.100006,2.500000
1443802146000,52.513971,13.462608,12.000000,11.000000,2.750000
1443802147000,52.514006,13.462637,12.000000,17.500000,3.250000
1443802148000,52.514053,13.462670,13.000000,18.299999,4.500000
1443802149000,52.514096,13.462698,13.000000,18.200001,4.500000
1443802150000,52.514138,13.462716,13.000000,15.700000,4.250000
1443802151000,52.514179,13.462724,13.000000,11.500000,4.250000
1443802152000,52.514207,13.462724,13.000000,4.400000,3.750000
1443802153000,52.514230,13.462715,13.000000,349.000000,3.500000
1443802154000,52.514246,13.462705,13.000000,326.899994,2.500000
1443802155000,52.514270,13.462696,13.000000,327.500000,3.000000
1443802156000,52.514298,13.462700,13.000000,337.000000,3.000000
1443802157000,52.514327,13.462708,13.000000,340.600006,3.000000
1443802158000,52.514360,13.462703,12.000000,336.200012,2.750000
1443802159000,52.514390,13.462712,13.000000,337.200012,2.500000
1443802160000,52.514420,13.462748,12.000000,350.299988,2.000000
1443802161000,52.514444,13.462787,13.000000,8.400000,1.250000
1443802162000,52.514468,13.462839,13.000000,37.400002,1.500000
1443802163000,52.514486,13.462900,13.000000,63.299999,1.750000
1443802164000,52.514501,13.462980,14.000000,78.699997,2.250000
1443802165000,52.514515,13.463084,13.000000,84.199997,3.500000
1443802166000,52.514528,13.463189,14.000000,87.500000,4.000000
1443802167000,52.514539,13.463285,13.000000,89.099998,3.750000
"""

gpx_blob = """<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="Endomondo.com" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd http://www.garmin.com/xmlschemas/GpxExtensions/v3 http://www.garmin.com/xmlschemas/GpxExtensionsv3.xsd http://www.garmin.com/xmlschemas/TrackPointExtension/v1 http://www.garmin.com/xmlschemas/TrackPointExtensionv1.xsd" xmlns="http://www.topografix.com/GPX/1/1" xmlns:gpxtpx="http://www.garmin.com/xmlschemas/TrackPointExtension/v1" xmlns:gpxx="http://www.garmin.com/xmlschemas/GpxExtensions/v3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <metadata>
  </metadata>
  <trk>
    <type>CYCLING_TRANSPORTATION</type>
    <trkseg>
      <trkpt lat="52.526548" lon="13.516359">
        <ele>46.0</ele>
        <time>2016-04-12T14:39:20Z</time>
      </trkpt>
      <trkpt lat="52.52586" lon="13.515258">
        <ele>21.0</ele>
        <time>2016-04-12T14:39:32Z</time>
      </trkpt>
      <trkpt lat="52.525992" lon="13.515334">
        <ele>100.0</ele>
        <time>2016-04-12T14:39:43Z</time>
      </trkpt>
      <trkpt lat="52.525772" lon="13.514536">
        <ele>85.0</ele>
        <time>2016-04-12T14:39:52Z</time>
      </trkpt>
      <trkpt lat="52.52575" lon="13.514287">
        <ele>130.0</ele>
        <time>2016-04-12T14:39:55Z</time>
      </trkpt>
      <trkpt lat="52.525873" lon="13.513808">
        <ele>62.0</ele>
        <time>2016-04-12T14:40:04Z</time>
      </trkpt>
      <trkpt lat="52.525484" lon="13.513622">
        <ele>115.0</ele>
        <time>2016-04-12T14:40:17Z</time>
      </trkpt>
      <trkpt lat="52.525718" lon="13.51345">
        <ele>111.0</ele>
        <time>2016-04-12T14:40:23Z</time>
      </trkpt>
      <trkpt lat="52.525086" lon="13.512815">
        <ele>131.0</ele>
        <time>2016-04-12T14:40:34Z</time>
      </trkpt>
      <trkpt lat="52.525088" lon="13.512635">
        <ele>51.0</ele>
        <time>2016-04-12T14:40:39Z</time>
      </trkpt>
      <trkpt lat="52.525192" lon="13.512041">
        <ele>91.0</ele>
        <time>2016-04-12T14:40:50Z</time>
      </trkpt>
      <trkpt lat="52.525267" lon="13.511514">
        <ele>99.0</ele>
        <time>2016-04-12T14:40:58Z</time>
      </trkpt>
      <trkpt lat="52.525115" lon="13.511649">
        <ele>90.0</ele>
        <time>2016-04-12T14:41:04Z</time>
      </trkpt>
      <trkpt lat="52.524959" lon="13.511615">
        <ele>122.0</ele>
        <time>2016-04-12T14:41:11Z</time>
      </trkpt>
      <trkpt lat="52.524861" lon="13.511051">
        <ele>86.0</ele>
        <time>2016-04-12T14:41:18Z</time>
      </trkpt>
      <trkpt lat="52.524703" lon="13.51079">
        <ele>86.0</ele>
        <time>2016-04-12T14:41:23Z</time>
      </trkpt>
      <trkpt lat="52.524394" lon="13.510454">
        <ele>98.0</ele>
        <time>2016-04-12T14:41:30Z</time>
      </trkpt>
      <trkpt lat="52.524369" lon="13.50998">
        <ele>109.0</ele>
        <time>2016-04-12T14:41:36Z</time>
      </trkpt>
      <trkpt lat="52.524098" lon="13.509894">
        <ele>138.0</ele>
        <time>2016-04-12T14:41:40Z</time>
      </trkpt>
      <trkpt lat="52.523972" lon="13.509802">
        <ele>16.0</ele>
        <time>2016-04-12T14:41:50Z</time>
      </trkpt>
      <trkpt lat="52.52374" lon="13.509514">
        <ele>81.0</ele>
        <time>2016-04-12T14:41:57Z</time>
      </trkpt>
      <trkpt lat="52.523599" lon="13.509239">
        <ele>41.0</ele>
        <time>2016-04-12T14:42:08Z</time>
      </trkpt>
      <trkpt lat="52.523322" lon="13.508756">
        <ele>102.0</ele>
        <time>2016-04-12T14:42:16Z</time>
      </trkpt>
      <trkpt lat="52.522935" lon="13.508968">
        <ele>136.0</ele>
        <time>2016-04-12T14:42:23Z</time>
      </trkpt>
      <trkpt lat="52.522751" lon="13.508646">
        <ele>128.0</ele>
        <time>2016-04-12T14:42:28Z</time>
      </trkpt>
      <trkpt lat="52.522863" lon="13.508904">
        <ele>76.0</ele>
        <time>2016-04-12T14:42:33Z</time>
      </trkpt>
      <trkpt lat="52.522404" lon="13.508809">
        <ele>134.0</ele>
        <time>2016-04-12T14:42:40Z</time>
      </trkpt>
      <trkpt lat="52.522366" lon="13.508575">
        <ele>103.0</ele>
        <time>2016-04-12T14:42:50Z</time>
      </trkpt>
      <trkpt lat="52.522067" lon="13.508683">
        <ele>99.0</ele>
        <time>2016-04-12T14:42:56Z</time>
      </trkpt>
      <trkpt lat="52.521786" lon="13.508738">
        <ele>89.0</ele>
        <time>2016-04-12T14:43:02Z</time>
      </trkpt>
      <trkpt lat="52.52153" lon="13.508881">
        <ele>104.0</ele>
        <time>2016-04-12T14:43:09Z</time>
      </trkpt>
      <trkpt lat="52.521302" lon="13.508805">
        <ele>87.0</ele>
        <time>2016-04-12T14:43:18Z</time>
      </trkpt>
      <trkpt lat="52.520922" lon="13.508632">
        <ele>82.0</ele>
        <time>2016-04-12T14:43:27Z</time>
      </trkpt>
      <trkpt lat="52.520584" lon="13.508824">
        <ele>75.0</ele>
        <time>2016-04-12T14:43:41Z</time>
      </trkpt>
      <trkpt lat="52.520231" lon="13.508815">
        <ele>88.0</ele>
        <time>2016-04-12T14:43:48Z</time>
      </trkpt>
      <trkpt lat="52.520091" lon="13.508414">
        <ele>84.0</ele>
        <time>2016-04-12T14:44:00Z</time>
      </trkpt>
      <trkpt lat="52.520157" lon="13.508087">
        <ele>96.0</ele>
        <time>2016-04-12T14:44:07Z</time>
      </trkpt>
      <trkpt lat="52.520094" lon="13.507702">
        <ele>66.0</ele>
        <time>2016-04-12T14:44:13Z</time>
      </trkpt>
      <trkpt lat="52.520796" lon="13.507819">
        <ele>130.0</ele>
        <time>2016-04-12T14:44:22Z</time>
      </trkpt>
      <trkpt lat="52.520453" lon="13.507458">
        <ele>88.0</ele>
        <time>2016-04-12T14:44:27Z</time>
      </trkpt>
      <trkpt lat="52.520435" lon="13.507029">
        <ele>89.0</ele>
        <time>2016-04-12T14:44:32Z</time>
      </trkpt>
      <trkpt lat="52.520353" lon="13.506638">
        <ele>80.0</ele>
        <time>2016-04-12T14:44:42Z</time>
      </trkpt>
    </trkseg>
  </trk>
</gpx>
"""


class Test(TestCase):

    def assert_valid_format(self, data):
        self.assertTrue('segments' in data.keys())
        for segment in data.get('segments'):
            for entry in segment:
                self.assertTrue(type(entry.get('ts')) in (int, float))

    def test_parse_gpx(self):
        res = parser.try_parse(gpx_blob)
        self.assertTrue(res is not None)
#        print(json.dumps(res, indent=4))
        self.assert_valid_format(res)

    def test_parse_csv(self):
        res = parser.try_parse(csv_blob)
        self.assertTrue(res is not None)
        self.assert_valid_format(res)
        for segment in res.get('segments'):
            for i in range(0, len(segment) - 1):
                pt1 = segment[i]
                pt2 = segment[i + 1]
                c_bear = calculate_bearing(pt1, pt2)
                print("Bearing -> orig: {}, calc: {}".format(
                    pt1['bear'], c_bear))

#                print("{},{}".format(pt1['lat'], pt1['long']))

    def test_calculate_bearing(self):
        pt1 = {
            'lat': 52.205,
            'long': 0.119,
        }
        pt2 = {
            'lat': 48.857,
            'long': 2.351,
        }

        bearing = calculate_bearing(pt1, pt2)
        self.assertEqual(int(bearing), int(156.2))


if __name__ == '__main__':
    TestCase.run()